const quizDatabase = {
    paragraph_14: {
        title: "§ 14. Развитие культуры Беларуси в XIX — начале ХХ в.",
        coverImage: "images/quiz_covers/culture_cover.jpg",
        questions: [
            {
                question: "Что способствовало техническому прогрессу в промышленности?",
                answers: [
                    "Развитие литературы",
                    "Создание театральных трупп",
                    "Проведение школьной реформы",
                    "Изобретение парового двигателя"
                ],
                correct: 3,
                explanation: "Правильный ответ: Изобретение парового двигателя. Именно паровой двигатель стал ключевым фактором промышленной революции в XIX веке."
            },
            {
                question: "Что было отличительной чертой нового этапа в развитии техники?",
                answers: [
                    "Ручной труд",
                    "Использование электричества",
                    "Производство машин с помощью других машин",
                    "Развитие торговли"
                ],
                correct: 2,
                explanation: "Правильный ответ: Производство машин с помощью других машин. Это означало переход к машинному производству средств производства."
            },
            {
                question: "Что вызвало переворот в развитии транспорта и связи?",
                answers: [
                    "Потребности торговли и промышленности",
                    "Развитие науки",
                    "Деятельность кружков",
                    "Школьная реформа"
                ],
                correct: 0,
                explanation: "Правильный ответ: Потребности торговли и промышленности. Экономические потребности стали основным двигателем технического прогресса."
            },
            {
                question: "Какие проблемы вызвала индустриализация?",
                answers: [
                    "Упрощение жизни",
                    "Рост стабильности",
                    "Ощущение утраты прочности",
                    "Ускорение прогресса"
                ],
                correct: 2,
                explanation: "Правильный ответ: Ощущение утраты прочности. Индустриализация принесла не только прогресс, но и социальные проблемы, включая чувство неуверенности."
            },
            {
                question: "Какие влияния испытывала культура Беларуси?",
                answers: [
                    "Только польское",
                    "Польское и российское",
                    "Только российское",
                    "Европейское"
                ],
                correct: 1,
                explanation: "Правильный ответ: Польское и российское. Культура Беларуси развивалась под влиянием обеих культур."
            },
            {
                question: "Под чьим влиянием развивалась шляхетская культура до 1830-1831 гг.?",
                answers: [
                    "Российским",
                    "Польским",
                    "Белорусским",
                    "Украинским"
                ],
                correct: 1,
                explanation: "Правильный ответ: Польским. До восстания 1830-1831 годов шляхетская культура развивалась преимущественно под польским влиянием."
            },
            {
                image: "images/questions/culture_7_horizontal.jpg",
                question: "В каком году был закрыт Виленский университет?",
                answers: [
                    "1833",
                    "1831",
                    "1830",
                    "1832"
                ],
                correct: 3,
                explanation: "Правильный ответ: 1832. Виленский университет был закрыт в 1832 году после восстания 1830-1831 годов."
            },
            {
                question: "Кто был носителем белорусских традиций и языка?",
                answers: [
                    "Шляхта",
                    "Крестьянство",
                    "Горожане",
                    "Духовенство"
                ],
                correct: 1,
                explanation: "Правильный ответ: Крестьянство. Именно крестьянство сохранило белорусские традиции и язык в XIX веке."
            },
            {
                question: "Когда была издана «Идиллия» Дунина-Марцинкевича?",
                answers: [
                    "1820 г.",
                    "1863 г.",
                    "1889 г.",
                    "1846 г."
                ],
                correct: 3,
                explanation: "Правильный ответ: 1846 г. «Идиллия» была издана в 1846 году и стала важным произведением белорусской литературы."
            },
            {
                question: "Какие сборники издал Богушевич?",
                type: "multiple",
                answers: [
                    "«флейта белорусская»",
                    "«Дудка белорусская»",
                    "«Смык белорусский»",
                    "«Первое чтение»"
                ],
                correct: [1, 2],
                explanation: "Правильный ответ: «Дудка белорусская» и «Смык белорусский». Франтишек Богушевич издал эти сборники в 1891 и 1894 годах."
            },
            {
                image: "images/questions/culture_11_vertical.jpg",
                question: "Кто дал название сборнику «Скрипка белорусская»?",
                answers: [
                    "Пашкевич",
                    "Богушевич",
                    "Купала",
                    "Колас"
                ],
                correct: 0,
                explanation: "Правильный ответ: Пашкевич. Алоиза Пашкевич (Тётка) издала сборник «Скрипка белорусская» в 1906 году."
            },
            {
                image: "images/questions/culture_12_vertical.jpg",
                question: "Какие вузы действовали в начале XIX века?",
                answers: [
                    "Только Виленский университет",
                    "Виленский университет и Полоцкая академия",
                    "Университеты Петербурга",
                    "Горы-Горецкий институт"
                ],
                correct: 1,
                explanation: "Правильный ответ: Виленский университет и Полоцкая академия. В начале XIX века на белорусских землях действовали эти два высших учебных заведения."
            },
            {
                question: "Что свидетельствует о сословном характере образования?",
                answers: [
                    "Всесословность",
                    "Наличие профессиональных училищ",
                    "Преемственность образования",
                    "Доступ низших сословий только к начальному образованию"
                ],
                correct: 3,
                explanation: "Правильный ответ: Доступ низших сословий только к начальному образованию. Сословный характер образования проявлялся в ограничении доступа к образованию для низших сословий."
            },
            {
                image: "images/questions/culture_14_horizontal.jpg",
                question: "Какое учебное заведение было первым сельскохозяйственным вузом?",
                answers: [
                    "Виленский университет",
                    "Горы-Горецкий институт",
                    "Полоцкая академия",
                    "Молодечненская семинария"
                ],
                correct: 1,
                explanation: "Правильный ответ: Горы-Горецкий институт. Горы-Горецкий земледельческий институт, открытый в 1840 году, был первым сельскохозяйственным вузом на территории Беларуси."
            },
            {
                question: "Какие учреждения давали среднее образование?",
                type: "multiple",
                answers: [
                    "Гимназии",
                    "Реальные училища",
                    "Кадетские корпуса",
                    "Церковно-приходские школы"
                ],
                correct: [0, 1],
                explanation: "Правильный ответ: Гимназии и реальные училища. Эти учреждения давали среднее образование в XIX веке."
            },
            {
                question: "Кто создал труд «Белорусы»?",
                answers: [
                    "Носович",
                    "Карский",
                    "Довнар-Запольский",
                    "Ластовский"
                ],
                correct: 1,
                explanation: "Правильный ответ: Карский. Евфимий Карский создал фундаментальный труд «Белорусы» в начале XX века."
            },
            {
                question: "Какой словарь создал Носович?",
                answers: [
                    "«Белорусы»",
                    "«Путешествие по Полесью»",
                    "«Краткая история Беларуси»",
                    "«Словарь белорусского наречия»"
                ],
                correct: 3,
                explanation: "Правильный ответ: «Словарь белорусского наречия». Иван Носович создал «Словарь белорусского наречия», изданный в 1870 году."
            },
            {
                question: "Какие стили сменяли друг друга в искусстве?",
                answers: [
                    "Барокко",
                    "Реализм",
                    "Модерн",
                    "Романтизм"
                ],
                correct: 1,
                explanation: "Правильный ответ: Реализм. В XIX - начале XX века в искусстве сменяли друг друга романтизм, реализм и модерн."
            },
            {
                image: "images/questions/culture_19_horizontal.jpg",
                question: "Кто был представителем романтизма?",
                answers: [
                    "Хруцкий",
                    "Ванькович",
                    "Силиванович",
                    "Пэн"
                ],
                correct: 1,
                explanation: "Правильный ответ: Ванькович. Валентий Ванькович был ярким представителем романтизма в белорусской живописи."
            },
            {
                image: "images/questions/culture_20_vertical.jpg",
                question: "Кто был мастером натюрморта?",
                answers: [
                    "Хруцкий",
                    "Ванькович",
                    "Шагал",
                    "Бялыницкий-Бируля"
                ],
                correct: 0,
                explanation: "Правильный ответ: Хруцкий. Иван Хруцкий был выдающимся мастером натюрморта в белорусской живописи XIX века."
            },
            {
                image: "images/questions/culture_21_vertical.jpg",
                question: "Кто основал школу в Витебске?",
                answers: [
                    "Шагал",
                    "Орда",
                    "Пэн",
                    "Горавский"
                ],
                correct: 2,
                explanation: "Правильный ответ: Пэн. Юдель Пэн основал художественную школу в Витебске, где учились многие известные художники."
            },
            {
                question: "Какой стиль был ведущим в первой половине XIX века?",
                answers: [
                    "Эклектика",
                    "Классицизм",
                    "Модерн",
                    "Барокко"
                ],
                correct: 1,
                explanation: "Правильный ответ: Классицизм. В первой половине XIX века в архитектуре преобладал классицизм."
            },
            {
                question: "Что характерно для архитектуры второй половины XIX века?",
                answers: [
                    "Эклектика",
                    "Классицизм",
                    "Модерн",
                    "Готика"
                ],
                correct: 0,
                explanation: "Правильный ответ: Эклектика. Для архитектуры второй половины XIX века была характерна эклектика - смешение различных стилей."
            },
            {
                question: "Какая опера считается первой белорусской?",
                answers: [
                    "«Павлинка»",
                    "«Идиллия»",
                    "«Разоренное гнездо»",
                    "«Селянка»"
                ],
                correct: 3,
                explanation: "Правильный ответ: «Селянка». Опера «Селянка» считается первой белорусской национальной оперой."
            },
            {
                image: "images/questions/culture_25_vertical.jpg",
                question: "Кто создал первую театральную труппу?",
                answers: [
                    "Буйницкий",
                    "Дунин-Марцинкевич",
                    "Жданович",
                    "Бурбис"
                ],
                correct: 1,
                explanation: "Правильный ответ: Дунин-Марцинкевич. Винцент Дунин-Марцинкевич создал первую белорусскую театральную труппу в середине XIX века."
            },
            {
                question: "Чья труппа гастролировала по империи в 1907 году?",
                answers: [
                    "Буйницкого",
                    "Дунина-Марцинкевича",
                    "Бурбиса",
                    "Ждановича"
                ],
                correct: 0,
                explanation: "Правильный ответ: Буйницкого. Труппа Игната Буйницкого гастролировала по Российской империи в 1907-1913 годах."
            }
        ]
    },

    paragraph_15: {
        title: "§ 15. Первая мировая война как рубежный период мировой истории",
        coverImage: "images/quiz_covers/medieval_cover.jpg",
        questions: []
    },

    paragraph_16: {
        title: "§ 16. Беларусь в годы Первой мировой войны",
        coverImage: "images/quiz_covers/empire_cover.jpg",
        questions: []
    }
};

const firebaseConfig = {
    apiKey: "AIzaSyDk1oxsi6xZVv1yf_-8SpOk4b1lapgr6bI",
    authDomain: "quiz-834d2.firebaseapp.com",
    projectId: "quiz-834d2",
    storageBucket: "quiz-834d2.firebasestorage.app",
    messagingSenderId: "287075846771",
    appId: "1:287075846771:web:e94f93858c2a18a47cb806",
    measurementId: "G-TSEBHY1WNX"
};

try {
    firebase.initializeApp(firebaseConfig);
} catch (error) {
    console.log('Firebase уже инициализирован');
}

const db = firebase.firestore();

let currentQuiz = null;
let currentQuizId = null;
let currentQuestion = 0;
let score = 0;
let timer = null;
let startTime = null;
let totalTimeSpent = 0;
let userAnswers = [];
let soundEnabled = true;
let selectedClass = null;
let selectedAnswers = [];
let correctAnswersCount = 0;

function formatTime(seconds) {
    if (seconds < 60) {
        return `${seconds} сек`;
    } else {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes} мин. ${remainingSeconds} сек`;
    }
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    updateSoundButton();
    localStorage.setItem('quizSoundEnabled', soundEnabled);
}

function updateSoundButton() {
    const soundToggle = document.getElementById('sound-toggle');
    const soundIcon = document.getElementById('sound-icon');
    const soundText = document.querySelector('.sound-text');
    
    if (soundToggle && soundIcon) {
        if (soundEnabled) {
            soundIcon.textContent = '🔊';
            soundText.textContent = 'Звук вкл';
            soundToggle.classList.remove('muted');
            soundToggle.title = 'Выключить звук';
        } else {
            soundIcon.textContent = '🔇';
            soundText.textContent = 'Звук выкл';
            soundToggle.classList.add('muted');
            soundToggle.title = 'Включить звук';
        }
    }
}

function playCorrectSound() {
    if (!soundEnabled) return;
    
    try {
        const sound = document.getElementById('correct-sound');
        if (sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Не удалось воспроизвести звук'));
        }
    } catch (error) {
        console.log('Ошибка воспроизведения звука');
    }
}

function playWrongSound() {
    if (!soundEnabled) return;
    
    try {
        const sound = document.getElementById('wrong-sound');
        if (sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Не удалось воспроизвести звук'));
        }
    } catch (error) {
        console.log('Ошибка воспроизведения звука');
    }
}

async function saveResultToFirebase(resultData) {
    try {
        console.log('Попытка сохранения в Firebase:', resultData);
        
        const docRef = await db.collection('quizResults').add({
            ...resultData,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            id: Date.now().toString()
        });
        
        console.log('✅ Результат успешно сохранен в Firebase с ID:', docRef.id);
        return true;
    } catch (error) {
        console.error('❌ Ошибка сохранения в Firebase:', error);
        saveResultToLocalStorage(resultData);
        return false;
    }
}

async function getResultsFromFirebase(quizId = null) {
    try {
        let query = db.collection('quizResults');
        
        if (quizId) {
            query = query.where('quizId', '==', quizId);
        }
        
        const snapshot = await query.orderBy('timestamp', 'desc').get();
        const results = [];
        
        snapshot.forEach(doc => {
            results.push({
                id: doc.id,
                ...doc.data()
            });
        });
        
        console.log('Загружено результатов из Firebase:', results.length);
        return results;
    } catch (error) {
        console.error('Ошибка загрузки из Firebase:', error);
        return getResultsFromLocalStorage(quizId);
    }
}

function saveResultToLocalStorage(resultData) {
    try {
        let leaders = JSON.parse(localStorage.getItem('quizLeaders') || '[]');
        leaders.push({
            name: resultData.playerClass,
            score: resultData.score,
            quiz: resultData.quizTitle,
            quizId: resultData.quizId,
            time: resultData.time,
            date: new Date().toLocaleDateString('ru-RU'),
            timestamp: new Date().getTime()
        });
        localStorage.setItem('quizLeaders', JSON.stringify(leaders));
        console.log('Результат сохранен локально');
    } catch (e) {
        console.error('Ошибка локального сохранения:', e);
    }
}

function getResultsFromLocalStorage(quizId = null) {
    try {
        const leaders = JSON.parse(localStorage.getItem('quizLeaders') || '[]');
        const formattedLeaders = leaders.map(item => ({
            playerClass: item.name,
            score: item.score,
            time: item.time,
            quizId: item.quizId,
            quizTitle: item.quiz,
            timestamp: item.timestamp
        }));
        
        if (quizId) {
            return formattedLeaders.filter(leader => leader.quizId === quizId);
        }
        return formattedLeaders;
    } catch (e) {
        console.error('Ошибка загрузки локальных данных:', e);
        return [];
    }
}

function startQuiz(quizId) {
    currentQuiz = quizDatabase[quizId];
    currentQuizId = quizId;
    
    if (!currentQuiz.questions || currentQuiz.questions.length === 0) {
        showNotification('Эта викторина скоро будет доступна!', 'info');
        return;
    }
    
    currentQuestion = 0;
    score = 0;
    userAnswers = [];
    selectedClass = null;
    selectedAnswers = [];
    correctAnswersCount = 0;
    startTime = new Date();
    
    const savedSound = localStorage.getItem('quizSoundEnabled');
    soundEnabled = savedSound !== null ? JSON.parse(savedSound) : true;
    updateSoundButton();
    
    document.getElementById('quiz-selection').classList.remove('active');
    document.getElementById('quiz-screen').classList.add('active');
    
    startTimer();
    showQuestion();
}

function showQuestion() {
    if (!currentQuiz) return;
    
    const question = currentQuiz.questions[currentQuestion];
    const questionImage = document.getElementById('question-image');
    
    questionImage.innerHTML = '';
    
    if (question.image && question.image.includes('.')) {
        questionImage.style.display = 'flex';
        
        const img = document.createElement('img');
        img.src = question.image;
        img.alt = 'Изображение вопроса';
        img.className = 'question-image-content';
        questionImage.appendChild(img);
        
        img.onerror = function() {
            questionImage.innerHTML = '';
            questionImage.style.display = 'none';
        };
    } else {
        questionImage.style.display = 'none';
    }
    
    const progress = ((currentQuestion) / currentQuiz.questions.length) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('progress-text').textContent = `Вопрос ${currentQuestion + 1}/${currentQuiz.questions.length}`;
    
    document.getElementById('question-text').textContent = question.question;
    
    const answersContainer = document.getElementById('answers-container');
    answersContainer.innerHTML = '';
    
    selectedAnswers = [];
    correctAnswersCount = Array.isArray(question.correct) ? question.correct.length : 1;
    
    question.answers.forEach((answer, index) => {
        const button = document.createElement('button');
        button.className = 'answer-btn';
        button.innerHTML = `
            <span class="answer-text">${answer}</span>
            <span class="answer-hover-effect"></span>
        `;
        
        if (question.type === 'multiple') {
            button.onclick = () => selectMultipleAnswer(index, button, question);
        } else {
            button.onclick = () => checkSingleAnswer(index, button, question);
        }
        
        answersContainer.appendChild(button);
    });
    
    document.getElementById('next-btn').style.display = 'none';
    document.getElementById('quiz-feedback').style.display = 'none';
    document.getElementById('answer-explanation').style.display = 'none';
}

function selectMultipleAnswer(index, button, question) {
    if (selectedAnswers.includes(index)) {
        return;
    }
    
    selectedAnswers.push(index);
    button.classList.add('selected');
    button.style.transform = 'translateX(5px) scale(1.05)';
    button.style.borderColor = 'var(--primary)';
    button.style.background = 'rgba(108, 99, 255, 0.2)';
    
    if (selectedAnswers.length === correctAnswersCount) {
        setTimeout(() => {
            checkMultipleAnswer(question);
        }, 500);
    }
}

function checkSingleAnswer(selectedIndex, button, question) {
    const answerButtons = document.querySelectorAll('.answer-btn');
    const feedback = document.getElementById('quiz-feedback');
    const explanation = document.getElementById('answer-explanation');
    
    userAnswers.push({
        question: question.question,
        userAnswer: question.answers[selectedIndex],
        correctAnswer: question.answers[question.correct],
        isCorrect: selectedIndex === question.correct
    });
    
    answerButtons.forEach(btn => {
        btn.classList.add('disabled');
        btn.onclick = null;
    });
    
    if (selectedIndex === question.correct) {
        button.classList.add('correct');
        feedback.textContent = '✅ Правильно! +1 балл';
        feedback.className = 'quiz-feedback correct';
        score += 1;
        
        playCorrectSound();
    } else {
        button.classList.add('incorrect');
        answerButtons[question.correct].classList.add('correct');
        feedback.textContent = '❌ Неправильно!';
        feedback.className = 'quiz-feedback incorrect';
        
        playWrongSound();
    }
    
    explanation.textContent = question.explanation;
    explanation.style.display = 'block';
    
    document.getElementById('next-btn').style.display = 'block';
}

function checkMultipleAnswer(question) {
    const answerButtons = document.querySelectorAll('.answer-btn');
    const feedback = document.getElementById('quiz-feedback');
    const explanation = document.getElementById('answer-explanation');
    
    const userAnswersText = selectedAnswers.map(idx => question.answers[idx]);
    const correctAnswersText = question.correct.map(idx => question.answers[idx]);
    
    userAnswers.push({
        question: question.question,
        userAnswers: userAnswersText,
        correctAnswers: correctAnswersText,
        isCorrect: false
    });
    
    answerButtons.forEach(btn => {
        btn.classList.add('disabled');
        btn.onclick = null;
    });
    
    const correctSet = new Set(question.correct);
    const selectedSet = new Set(selectedAnswers);
    const isCorrect = selectedSet.size === correctSet.size && 
                     Array.from(selectedSet).every(val => correctSet.has(val));
    
    answerButtons.forEach((button, index) => {
        if (question.correct.includes(index)) {
            button.classList.add('correct');
        } else if (selectedAnswers.includes(index) && !question.correct.includes(index)) {
            button.classList.add('incorrect');
        }
    });
    
    if (isCorrect) {
        feedback.textContent = '✅ Правильно! +1 балл';
        feedback.className = 'quiz-feedback correct';
        score += 1;
        playCorrectSound();
        userAnswers[userAnswers.length - 1].isCorrect = true;
    } else {
        feedback.textContent = '❌ Неправильно!';
        feedback.className = 'quiz-feedback incorrect';
        playWrongSound();
    }
    
    explanation.textContent = question.explanation;
    explanation.style.display = 'block';
    
    document.getElementById('next-btn').style.display = 'block';
}

function nextQuestion() {
    currentQuestion++;
    
    if (currentQuestion < currentQuiz.questions.length) {
        showQuestion();
    } else {
        finishQuiz();
    }
}

function startTimer() {
    startTime = new Date();
    timer = setInterval(() => {
        const currentTime = new Date();
        totalTimeSpent = Math.floor((currentTime - startTime) / 1000);
        document.getElementById('timer').textContent = formatTime(totalTimeSpent);
    }, 1000);
}

function finishQuiz() {
    clearInterval(timer);
    
    const endTime = new Date();
    totalTimeSpent = Math.floor((endTime - startTime) / 1000);
    
    document.getElementById('quiz-screen').classList.remove('active');
    document.getElementById('results-screen').classList.add('active');
    
    const finalScore = score;
    
    document.getElementById('correct-answers').textContent = `${finalScore}/${currentQuiz.questions.length}`;
    document.getElementById('time-spent').textContent = formatTime(totalTimeSpent);
    document.getElementById('total-score').textContent = finalScore;
    
    selectedClass = null;
    document.querySelectorAll('.class-option').forEach(opt => {
        opt.classList.remove('active');
    });
}

function restartQuiz() {
    document.getElementById('results-screen').classList.remove('active');
    document.getElementById('quiz-selection').classList.add('active');
}

async function saveResults() {
    if (!selectedClass) {
        showNotification('Пожалуйста, выберите ваш класс!', 'error');
        return;
    }
    
    const playerName = '11' + selectedClass;
    const finalScore = parseInt(document.getElementById('total-score').textContent);
    
    const resultData = {
        playerClass: playerName,
        score: finalScore,
        time: totalTimeSpent,
        quizId: currentQuizId,
        quizTitle: currentQuiz.title
    };
    
    const saveBtn = document.querySelector('.btn-primary');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<span>⏳ Сохранение...</span>';
    saveBtn.disabled = true;
    
    try {
        const firebaseSuccess = await saveResultToFirebase(resultData);
        
        if (firebaseSuccess) {
            showNotification('Результат успешно сохранен в общую таблицу!', 'success');
            
            setTimeout(() => {
                window.location.href = `leaders.html?quiz=${currentQuizId}`;
            }, 2000);
        } else {
            showNotification('Результат сохранен локально. Общая таблица недоступна.', 'warning');
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        }
        
    } catch (error) {
        console.error('Ошибка сохранения:', error);
        showNotification('Ошибка сохранения', 'error');
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
    }
}

function showNotification(message, type = 'info') {
    document.querySelectorAll('.notification').forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <span class="notification-icon">${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</span>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 4000);
}

function initClassSelector() {
    const classOptions = document.querySelectorAll('.class-option');
    
    classOptions.forEach(option => {
        option.addEventListener('click', function() {
            classOptions.forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            selectedClass = this.getAttribute('data-class');
            console.log('Выбран класс:', selectedClass);
        });
    });
}

document.addEventListener('DOMContentLoaded', function() {
    initClassSelector();
    
    const testAudio = document.createElement('audio');
    if (!testAudio.canPlayType) {
        soundEnabled = false;
        const soundToggle = document.getElementById('sound-toggle');
        if (soundToggle) {
            soundToggle.style.display = 'none';
        }
    }
    
    const savedSound = localStorage.getItem('quizSoundEnabled');
    if (savedSound !== null) {
        soundEnabled = JSON.parse(savedSound);
    }
    updateSoundButton();
    
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.querySelectorAll('audio').forEach(audio => {
                audio.pause();
            });
        }
    });
});